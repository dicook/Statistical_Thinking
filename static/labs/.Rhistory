ggplot(usworkcomp, aes(x=Loss)) + geom_histogram()
ggplot(usworkcomp, aes(x=LOSS)) + geom_histogram()
fitdistr(usworkcomp$LOSS, "gamma")
fitdistr(usworkcomp$LOSS, "lognormal")
summary(usworkcomp$LOSS)
fitdistr(usworkcomp$LOSS+1, "gamma")
fitdistr(usworkcomp$LOSS+100, "gamma")
?fitdistr
library(CASdatasets)
data(danishuni)
summary(danishuni)
summary(usworkcomp$LOSS)
fitdistr((usworkcomp$LOSS+100)/100000, "gamma")
fitdistr((usworkcomp$LOSS+100)/100000, "lognormal")
fitdistr((usworkcomp$LOSS+100)/100000, "gamma")
fitdistr((usworkcomp$LOSS+100)/100000, "lognormal")
n <- nrow(usworkcomp)
df <- data.frame(x1=sort(usworkcomp$LOSS))
df$qg = (qgamma(c(1 - 0.5^(1/n), (2:(n-1) - 0.3175) /
(n + 0.365),0.5^(1/n)), 0.367774667, 0.023499352))*100000-100
df$qln = (qlnorm(c(1 - 0.5^(1/n), (2:(n-1) - 0.3175) /
(n + 0.365),0.5^(1/n)), 0.93691677, 2.84185608))*100000-100
p1 <- ggplot(df, aes(x=x1, y=qg)) +
geom_abline(intercept=0, slope=1) +
geom_point() + theme(aspect.ratio=1)
p2 <- ggplot(df, aes(x=x1, y=qln)) +
geom_abline(intercept=0, slope=1) +
geom_point() + theme(aspect.ratio=1)
grid.arrange(p1, p2, ncol=2)
library("tidyverse")
library("gapminder")
glimpse(gapminder)
ggplot(data=gapminder, aes(x=year, y=lifeExp, group=country)) +
geom_line(alpha=0.5)
oz <- gapminder2 %>% filter(country=="Australia")
gapminder2 <- gapminder %>% mutate(year1950 = year-1950)
oz <- gapminder2 %>% filter(country=="Australia")
head(oz)
ggplot(data=oz, aes(x=year, y=lifeExp)) +
geom_point() +
geom_smooth(method="lm", se=FALSE)
oz_lm <- lm(lifeExp~year1950, data=oz)
oz_lm
library("broom")
oz_coef <- tidy(oz_lm)
oz_coef
oz_fit <- glance(oz_lm)
oz_fit
oz_diag <- augment(oz_lm)
?augment
install.packages("broom")
install.packages("purrr")
library("broom")
oz_coef <- tidy(oz_lm)
oz_coef
oz_fit <- glance(oz_lm)
oz_fit
oz_diag <- augment(oz_lm)
oz_diag
library("purrr")
by_country <- gapminder2 %>%
select(country, year1950, lifeExp, continent) %>%
group_by(country, continent) %>%
nest()
library("tidyverse")
by_country <- gapminder2 %>%
select(country, year1950, lifeExp, continent) %>%
group_by(country, continent) %>%
nest()
by_country <- by_country %>%
mutate(
model = purrr::map(data, ~ lm(lifeExp ~ year1950,
data = .))
)
country_coefs <- by_country %>%
unnest(model %>% purrr::map(broom::tidy))
country_coefs <- country_coefs %>%
select(country, continent, term, estimate) %>%
spread(term, estimate)
kable(head(country_coefs))
library(knitr)
kable(head(country_coefs))
n <- length(table(gapminder2$country))
country_coefs <- data.frame(country=gapminder2$country[seq(1, 1704, 12)],
continent=gapminder2$continent[seq(1, 1704, 12)],
intercept=rep(0,n),
year1950=rep(0,n))
for (i in 1:n) {
sub <- gapminder2 %>% filter(country==country_coefs$country[i])
sub_lm <- lm(lifeExp~year1950, data=sub)
sub_lm_coefs <- coefficients(sub_lm)
country_coefs$intercept[i] <- sub_lm_coefs[1]
country_coefs$year1950[i] <- sub_lm_coefs[2]
}
kable(head(country_coefs))
ggplot(country_coefs, aes(x=intercept, y=year1950, colour=continent)) +
geom_point()
ggplot(country_coefs, aes(x=intercept, y=year1950,
colour=continent, label=country)) +
geom_point()
library(plotly)
ggplotly()
country_fit <- by_country %>%
unnest(model %>%
purrr::map(broom::glance))
ggplot(country_fit, aes(x=r.squared)) + geom_histogram()
badfit <- country_fit %>% filter(r.squared <= 0.45)
gapminder2_sub <- gapminder2 %>% filter(country %in% badfit$country)
ggplot(data=gapminder2_sub, aes(x=year, y=lifeExp)) +
geom_point() +
facet_wrap(~country) +
scale_x_continuous(breaks=seq(1950,2000,10),
labels=c("1950", "60","70", "80","90","2000")) +
geom_smooth(method="lm", se=FALSE)
knitr::opts_chunk$set(
message = FALSE,
warning = FALSE,
error = FALSE,
echo = FALSE,
collapse = TRUE,
comment = "#",
fig.height = 4,
fig.width = 8,
fig.align = "center",
cache = FALSE
)
yawn_expt <- data.frame(group=c(rep("treatment", 34), rep("control", 16)),
yawn=c(rep("yes", 10), rep("no", 24), rep("yes", 4), rep("no", 12)))
library(dplyr)
library(tidyr)
library(knitr)
yawn_expt %>%
group_by(group, yawn) %>%
tally() %>%
ungroup() %>%
spread(yawn, n, fill=0) %>%
mutate(total = rowSums(.[-1])) %>%
kable()
library("tidyverse")
load("pisa_au.rda")
sci_scores <- pisa_au %>% select(PV1SCIE, PV2SCIE, PV3SCIE, PV4SCIE, PV5SCIE)
ggscatmat(sci_scores)
library("GGally")
ggscatmat(sci_scores)
sci_scores <- pisa_au %>% select(PV1SCIE, PV2SCIE, PV3SCIE, PV4SCIE, PV5SCIE) %>% as.data.frame()
ggscatmat(sci_scores)
ggscatmat(sci_scores, alpha=0.1)
sci_scores <- pisa_au %>% select(PV1SCIE, PV2SCIE, PV3SCIE, PV4SCIE, PV5SCIE, PV6SCIE, PV7SCIE, PV8SCIE, PV9SCIE, PV10SCIE) %>% as.data.frame()
ggscatmat(sci_scores, alpha=0.1)
pisa_au %>% group_by(SCHOOLID) %>%
tally() %>%
arrange(desc(n)) -> aus_schools
head(pisa_au$STRATUM)
pisa_au %>% group_by(STRATUM) %>%
tally()
pisa_au %>% group_by(STRATUM) %>%
tally() %>%
arrange(desc(n)) -> aus_schools
pisa_au %>% group_by(CNTSCHID) %>%
tally() %>%
arrange(desc(n)) -> aus_schools
ggplot(aus_schools, aes(x=n)) + geom_histogram()
ggplot(aus_schools, aes(x=n)) + geom_density()
ggplot(aus_schools, aes(x=n)) + geom_density(fill="black", alpha=0.5)
pisa_au %>% group_by(CNTSCHID) %>%
tally() %>%
arrange(desc(n)) -> aus_schools
dim(aus_schools)
ggplot(aus_schools, aes(x=n)) + geom_density(fill="black", alpha=0.5)
table(pisa_au$PA042Q01TA)
head(pisa_au$PA042Q01TA)
summary(pisa_au$WEALTH)
pisa_au <- pisa_au %>%
select(science, OUTHOURS, ANXTEST, EMOSUPP, PARED, JOYSCIE, WEALTH, ST013Q01TA, ST012Q01TA, SENWT)
pisa_au <- pisa_au %>% mutate(science = (PV1SCIE+PV2SCIE+PV3SCIE+PV4SCIE+PV5SCIE+PV6SCIE+PV7SCIE+PV8SCIE+PV9SCIE+PV10SCIE)/10)
pisa_au <- pisa_au %>%
select(science, OUTHOURS, ANXTEST, EMOSUPP, PARED, JOYSCIE, WEALTH, ST013Q01TA, ST012Q01TA, SENWT)
View(pisa_au)
summary(pisa_au)
load("pisa_au.rda")
pisa_au <- pisa_au %>% mutate(science = (PV1SCIE+PV2SCIE+PV3SCIE+PV4SCIE+PV5SCIE+PV6SCIE+PV7SCIE+PV8SCIE+PV9SCIE+PV10SCIE)/10)
pisa_au <- pisa_au %>%
select(science, ST004D01T, OUTHOURS, ANXTEST, EMOSUPP, PARED, JOYSCIE, WEALTH, ST013Q01TA, ST012Q01TA, SENWT)
pisa_au %>% count(ST004D01T)
pisa_au %>% summary(OUTHOURS)
pisa_au <- pisa_au %>% select(-EMOSUPP)
aus_nomiss <- pisa_au %>% filter(!is.na(OUTHOURS)) %>%
filter(!is.na(ANXTEST)) %>% filter(!is.na(PARED)) %>%
filter(!is.na(JOYSCIE)) %>% filter(!is.na(WEALTH)) %>%
filter(!is.na(ST013Q01TA)) %>% filter(!is.na(ST012Q01TA))
aus_nomiss <- pisa_au %>% #filter(!is.na(OUTHOURS)) %>%
filter(!is.na(ANXTEST)) %>% filter(!is.na(PARED)) %>%
filter(!is.na(JOYSCIE)) %>% filter(!is.na(WEALTH)) %>%
filter(!is.na(ST013Q01TA)) %>% filter(!is.na(ST012Q01TA))
ggplot(aus_nomiss, aes(x=SENWT)) + geom_density(colour="black", alpha=0.5)
ggplot(aus_nomiss, aes(x=SENWT)) + geom_density(fill="black", alpha=0.5)
ggplot(aus_nomiss, aes(x=SENWT)) +
facet_wrap(~ST004D01T) +
geom_density(fill="black", alpha=0.5)
library("forcats")
?fct_relabel
aus_glm_test <- glm(science_std~ST004D01T+ST013Q01TA+ST012Q01TA,
data=aus_nomiss, weights=SENWGT_STU)
aus_nomiss <- aus_nomiss %>%
mutate(ST004D01T=fct_recode(ST004D01T, 1="f", 2="m"))
aus_nomiss <- aus_nomiss %>%
mutate(ST004D01T=fct_recode(ST004D01T, "1"="f", "2"="m"))
aus_nomiss <- aus_nomiss %>%
mutate(ST004D01T=recode(ST004D01T, "1"="f", "2"="m"))
aus_nomiss <- aus_nomiss %>%
mutate(ST004D01T=factor(ST004D01T, levels=c(1,2), labels=c("f", "m")))
aus_nomiss <- aus_nomiss %>% mutate(science_std = scale(science))
aus_glm_test <- glm(science_std~ST004D01T+ST013Q01TA+ST012Q01TA,
data=aus_nomiss, weights=SENWGT_STU)
aus_glm_test <- glm(science_std~ST004D01T+ST013Q01TA+ST012Q01TA,
data=aus_nomiss, weights=SENWT)
summary(aus_glm_test)
aus_glm_test <- glm(science_std~ST004D01T+JOYSCIE,
data=aus_nomiss, weights=SENWT)
summary(aus_glm_test)
summary(pisa_au)
summary(aus_nomiss)
?scale
aus_nomiss <- pisa_au %>% filter(!is.na(OUTHOURS)) %>%
filter(!is.na(ANXTEST)) %>% filter(!is.na(PARED)) %>%
filter(!is.na(JOYSCIE)) %>% filter(!is.na(WEALTH)) %>%
filter(!is.na(ST013Q01TA)) %>% filter(!is.na(ST012Q01TA))
aus_nomiss <- aus_nomiss %>%
mutate(ST004D01T=factor(ST004D01T, levels=c(1,2), labels=c("f", "m")))
aus_nomiss <- aus_nomiss %>%
mutate(science_std = (science-mean(science))/sd(science))
aus_glm_test <- glm(science_std~ST004D01T+JOYSCIE,
data=aus_nomiss, weights=SENWT)
summary(aus_glm_test)
summary(aus_nomiss)
aus_glm <- glm(science_std~ST004D01T+OUTHOURS+ANXTEST+PARED+JOYSCIE+WEALTH+ST013Q01TA+ST012Q01TA, data=aus_nomiss, weights=SENWGT_STU)
aus_glm <- glm(science_std~ST004D01T+OUTHOURS+ANXTEST+PARED+JOYSCIE+WEALTH+ST013Q01TA+ST012Q01TA, data=aus_nomiss, weights=SENWT)
summary(aus_glm)
library("broom")
aus_glm_augment <- augment(aus_glm)
ggplot(aus_glm_augment, aes(x=.hat, y=.cooksd)) + geom_point()
ggplot(aus_glm_augment, aes(x=.fitted, y=math_std)) + geom_point()
ggplot(aus_glm_augment, aes(x=.fitted, y=science_std)) + geom_point()
ggplot(aus_glm_augment, aes(x=.fitted, y=.resid)) + geom_point()
p1 <- ggplot(aus_glm_augment, aes(x=.resid)) + geom_histogram()
n <- nrow(aus_nomiss)
aus_glm_augment$q = qnorm(c(1 - 0.5^(1/n), (2:(n-1) - 0.3175) /
(n + 0.365),0.5^(1/n)), 2, 0.5)
p2 <- ggplot(aus_glm_augment, aes(x=sort(.resid), y=q)) + geom_point() +
geom_smooth(method="lm", se=FALSE) + theme(aspect.ratio=1)
library("gridExtra")
grid.arrange(p1, p2, ncol=2)
library("car")
vif(aus_glm)
ggplot(aus_nomiss, aes(x=JOYSCIE, y=science_std, colour=ST004D01T)) +
geom_point(alpha=0.2) +
geom_smooth(method="lm", se=F)
library("tidyverse")
load("pisa_au.rda")
library("forcats")
pisa_au <- pisa_au %>%
mutate(science = (PV1SCIE+PV2SCIE+PV3SCIE+PV4SCIE+
PV5SCIE+PV6SCIE+PV7SCIE+PV8SCIE+
PV9SCIE+PV10SCIE)/10)
pisa_au <- pisa_au %>%
select(science, ST004D01T, OUTHOURS, ANXTEST, EMOSUPP, PARED, JOYSCIE, WEALTH, ST013Q01TA, ST012Q01TA, SENWT)
pisa_au <- pisa_au %>% mutate(science = (PV1SCIE+PV2SCIE+PV3SCIE+PV4SCIE+PV5SCIE+PV6SCIE+PV7SCIE+PV8SCIE+PV9SCIE+PV10SCIE)/10)
pisa_au <- pisa_au %>% select(-EMOSUPP)
aus_nomiss <- pisa_au %>% filter(!is.na(OUTHOURS)) %>%
filter(!is.na(ANXTEST)) %>% filter(!is.na(PARED)) %>%
filter(!is.na(JOYSCIE)) %>% filter(!is.na(WEALTH)) %>%
filter(!is.na(ST013Q01TA)) %>% filter(!is.na(ST012Q01TA))
aus_nomiss <- aus_nomiss %>%
mutate(ST004D01T=factor(ST004D01T, levels=c(1,2), labels=c("f", "m")))
aus_nomiss <- aus_nomiss %>%
mutate(science_std = (science-mean(science))/sd(science))
aus_glm_test <- glm(science_std~ST004D01T+JOYSCIE,
data=aus_nomiss, weights=SENWT)
summary(aus_glm_test)
coefs <- coefficients(aus_glm_test)
ggplot() +
geom_abline(intercept=coefs[1], slope=coefs[3], colour="red") +
geom_abline(intercept=coefs[1]+coefs[2], slope=coefs[2], colour="blue")
ggplot() +
geom_abline(intercept=coefs[1], slope=coefs[3], colour="red") +
geom_abline(intercept=coefs[1]+coefs[2], slope=coefs[3], colour="blue") +
xlim(range(aus_nomiss$JOYSCIE)) + ylim(range(aus_nomiss$science_std))
ggplot() +
geom_abline(intercept=coefs[1], slope=coefs[3], colour="red") +
geom_abline(intercept=coefs[1]+coefs[2], slope=coefs[3], colour="blue") +
xlim(range(aus_nomiss$JOYSCIE)) + ylim(c(-1,1))
aus_nomiss_m <- aus_nomiss %>% gather(-science_std, -SENWT)
aus_nomiss_m <- aus_nomiss %>% gather(var, val, -science_std, -SENWT)
ggplot(aus_nomiss_m, aes(x=val, y=science_std)) + geom_point() +
facet_wrap(~var, scales="free")
aus_nomiss_m <- aus_nomiss %>% filter(-science, -SENWT) %>%
gather(var, val, -science_std, -SENWT)
point
aus_nomiss_m <- aus_nomiss %>% filter(-science, -SENWT) %>%
gather(var, val, -science_std, -SENWT)
ggplot(aus_nomiss_m, aes(x=val, y=science_std)) + geom_point() +
facet_wrap(~var, scales="free")
aus_nomiss_m <- aus_nomiss %>% select(-science, -SENWT) %>%
gather(var, val, -science_std, -SENWT)
aus_nomiss_m <- aus_nomiss %>% select(-science, -SENWT) %>%
gather(var, val, -science_std)
ggplot(aus_nomiss_m, aes(x=val, y=science_std)) + geom_point() +
facet_wrap(~var, scales="free")
ggplot(aus_nomiss, aes(x=ST004D01T, y=science_std)) + geom_boxplot()
ggplot(aus_nomiss, aes(x=factor(ST012Q01TA), y=science_std)) + geom_boxplot()
ggplot(aus_nomiss, aes(x=factor(ST013Q01TA), y=science_std)) + geom_boxplot()
ggplot(aus_nomiss, aes(x=factor(PARED), y=science_std)) + geom_boxplot()
ggplot(aus_nomiss, aes(x=ANXTEST, y=science_std)) + geom_smooth()
ggplot(aus_nomiss, aes(x=JOYSCIE, y=science_std)) + geom_smooth()
ggplot(aus_nomiss, aes(x=WEALTH, y=science_std)) + geom_smooth()
p1 <- ggplot(aus_nomiss, aes(x=ST004D01T, y=science_std)) +
geom_boxplot() + xlab("Gender")
p2 <- ggplot(aus_nomiss, aes(x=factor(ST012Q01TA), y=science_std)) + geom_boxplot() + xlab("TVs")
p3 <- ggplot(aus_nomiss, aes(x=factor(ST013Q01TA), y=science_std)) + geom_boxplot() + xlab("Books")
p4 <- ggplot(aus_nomiss, aes(x=factor(PARED), y=science_std)) + geom_boxplot() + xlab("Parents years of schools")
p5 <- ggplot(aus_nomiss, aes(x=ANXTEST, y=science_std)) + geom_smooth()
p6 <- ggplot(aus_nomiss, aes(x=JOYSCIE, y=science_std)) + geom_smooth()
p7 <- ggplot(aus_nomiss, aes(x=WEALTH, y=science_std)) + geom_smooth()
grid.arrange(p1, p2, p3, p4, p5, p6, p7, ncol=4)
library(gridExtra)
grid.arrange(p1, p2, p3, p4, p5, p6, p7, ncol=4)
p1 <- ggplot(aus_nomiss, aes(x=ST004D01T, y=science_std)) +
geom_boxplot() + xlab("Gender")
p2 <- ggplot(aus_nomiss, aes(x=factor(ST012Q01TA), y=science_std)) + geom_boxplot() + xlab("TVs")
p3 <- ggplot(aus_nomiss, aes(x=factor(ST013Q01TA), y=science_std)) + geom_boxplot() + xlab("Books")
p4 <- ggplot(aus_nomiss, aes(x=factor(PARED), y=science_std)) + geom_boxplot() + xlab("Parents years of schools")
p5 <- ggplot(aus_nomiss, aes(x=OUTHOURS, y=science_std)) + geom_smooth()
p6 <- ggplot(aus_nomiss, aes(x=ANXTEST, y=science_std)) + geom_smooth()
p7 <- ggplot(aus_nomiss, aes(x=JOYSCIE, y=science_std)) + geom_smooth()
p8 <- ggplot(aus_nomiss, aes(x=WEALTH, y=science_std)) + geom_smooth()
grid.arrange(p1, p2, p3, p4, p5, p6, p7, p8, ncol=4)
p1 <- ggplot(aus_nomiss, aes(x=ST004D01T, y=science_std)) +
geom_boxplot() + xlab("Gender")
p2 <- ggplot(aus_nomiss, aes(x=factor(ST012Q01TA), y=science_std)) + geom_boxplot() + xlab("TVs")
p3 <- ggplot(aus_nomiss, aes(x=factor(ST013Q01TA), y=science_std)) + geom_boxplot() + xlab("Books")
p4 <- ggplot(aus_nomiss, aes(x=PARED, y=science_std)) + geom_smooth() + xlab("Parents years of schools")
p5 <- ggplot(aus_nomiss, aes(x=OUTHOURS, y=science_std)) + geom_smooth()
p6 <- ggplot(aus_nomiss, aes(x=ANXTEST, y=science_std)) + geom_smooth()
p7 <- ggplot(aus_nomiss, aes(x=JOYSCIE, y=science_std)) + geom_smooth()
p8 <- ggplot(aus_nomiss, aes(x=WEALTH, y=science_std)) + geom_smooth()
grid.arrange(p1, p2, p3, p4, p5, p6, p7, p8, ncol=4)
ggplot(aus_nomiss, aes(x=PARED, y=science_std)) + geom_smooth() + xlab("Parents years of schools")
ggplot(aus_nomiss, aes(x=PARED, y=science_std)) + geom_point() + xlab("Parents years of schools")
ggplot(aus_nomiss, aes(x=PARED, y=science_std)) + geom_smooth(method="lm") + xlab("Parents years of schools")
ggplot(aus_nomiss, aes(x=factor(PARED), y=science_std)) + geom_boxplot() + xlab("Parents years of schools")
aus_nomiss <- pisa_au %>% #filter(!is.na(OUTHOURS)) %>%
filter(!is.na(ANXTEST)) %>% filter(!is.na(PARED)) %>%
filter(!is.na(JOYSCIE)) %>% filter(!is.na(WEALTH)) %>%
filter(!is.na(ST013Q01TA)) %>% filter(!is.na(ST012Q01TA))
aus_nomiss <- aus_nomiss %>%
mutate(ST004D01T=factor(ST004D01T, levels=c(1,2), labels=c("f", "m")))
aus_nomiss <- aus_nomiss %>%
mutate(science_std = (science-mean(science))/sd(science))
aus_glm <- glm(science_std~ST004D01T+ANXTEST+PARED+JOYSCIE+WEALTH+ST013Q01TA+ST012Q01TA, data=aus_nomiss, weights=SENWT)
summary(aus_glm)
aus_glm <- glm(science_std~ANXTEST +
PARED + JOYSCIE + WEALTH + ST013Q01TA + ST012Q01TA,
data=aus_nomiss, weights=SENWT)
summary(aus_glm)
2*6/12118
library("broom")
aus_glm_augment <- augment(aus_glm)
ggplot(aus_glm_augment, aes(x=.hat, y=.cooksd)) + geom_point()
aus_glm_augment %>% filter(.hat > 0.00099) %>% tally()
0.193621*5
(3264.3-2345.3)/3264.3
library(tidyverse)
load("pisa_au.rda")
pisa_au <- pisa_au %>%
select(science, ST004D01T, JOYSCIE, ST013Q01TA, ST012Q01TA, SENWT)
pisa_au <- pisa_au %>%
mutate(science = (PV1SCIE+PV2SCIE+PV3SCIE+PV4SCIE+
PV5SCIE+PV6SCIE+PV7SCIE+PV8SCIE+
PV9SCIE+PV10SCIE)/10) %>%
select(science, ST004D01T, JOYSCIE, ST013Q01TA, ST012Q01TA, SENWT)
aus_nomiss <- pisa_au %>%
filter(!is.na(JOYSCIE)) %>%
filter(!is.na(ST013Q01TA)) %>% filter(!is.na(ST012Q01TA))
aus_nomiss <- aus_nomiss %>%
mutate(ST004D01T=factor(ST004D01T, levels=c(1,2), labels=c("f", "m")),
science_std = (science-mean(science))/sd(science)) %>%
rename(gender=ST004D01T, nbooks=ST013Q01TA, ntvs=ST012Q01TA)
aus_glm <- glm(science_std~gender+JOYSCIE+nbooks+ntvs, data=aus_nomiss, weights=SENWT)
summary(aus_glm)
summary(pisa_au$JOYSCIE)
summary(aus_nomiss$JOYSCIE)
knitr::opts_chunk$set(
message = FALSE,
warning = FALSE,
error = FALSE,
echo = FALSE,
collapse = TRUE,
comment = "#",
fig.height = 4,
fig.width = 8,
fig.align = "center",
cache = FALSE
)
options(digits = 3)
library(knitr)
library(tidyverse)
load("pisa_au.rda")
pisa_au <- pisa_au %>%
mutate(science = (PV1SCIE+PV2SCIE+PV3SCIE+PV4SCIE+
PV5SCIE+PV6SCIE+PV7SCIE+PV8SCIE+
PV9SCIE+PV10SCIE)/10) %>%
select(science, ST004D01T, JOYSCIE, ST013Q01TA, ST012Q01TA, SENWT)
aus_nomiss <- pisa_au %>%
filter(!is.na(JOYSCIE)) %>%
filter(!is.na(ST013Q01TA)) %>% filter(!is.na(ST012Q01TA))
aus_nomiss <- aus_nomiss %>%
mutate(ST004D01T=factor(ST004D01T, levels=c(1,2), labels=c("f", "m")),
science_std = (science-mean(science))/sd(science)) %>%
rename(gender=ST004D01T, nbooks=ST013Q01TA, ntvs=ST012Q01TA)
aus_glm <- glm(science_std~gender+JOYSCIE+nbooks+ntvs, data=aus_nomiss, weights=SENWT)
summary(aus_glm)
coef <- summary(aus_glm)$coefficients
n <- nrow(aus_nomiss)
View(coef)
coef[4,1]-qt(0.975, n-5)*coef[4,2]
coef[4,1]+qt(0.975, n-5)*coef[4,2]
library(boot)
calc_stat <- function(d, i) {
x <- d[i,]
mod <- glm(cience_std~gender+JOYSCIE+nbooks+ntvs, data=aus_nomiss, weights=SENWT)
stat <- as.numeric(coefficients(mod)[4])
return(stat)
}
stat <- boot(aus_nomiss, statistic=calc_stat, R=1000,
weights=aus_nomiss$SENWGT_STU)
stat <- boot(aus_nomiss, statistic=calc_stat, R=1000,
weights=aus_nomiss$SENWT)
mod <- glm(science_std~gender+JOYSCIE+nbooks+ntvs, data=aus_nomiss, weights=SENWT)
calc_stat <- function(d, i) {
x <- d[i,]
mod <- glm(science_std~gender+JOYSCIE+nbooks+ntvs, data=aus_nomiss, weights=SENWT)
stat <- as.numeric(coefficients(mod)[4])
return(stat)
}
stat <- boot(aus_nomiss, statistic=calc_stat, R=1000,
weights=aus_nomiss$SENWT)
stat
sort(stat$t)[25]
sort(stat$t)[975]
calc_stat <- function(d, i) {
x <- d[i,]
mod <- glm(science_std~gender+JOYSCIE+nbooks+ntvs, data=x, weights=SENWT)
stat <- as.numeric(coefficients(mod)[4])
return(stat)
}
stat <- boot(aus_nomiss, statistic=calc_stat, R=1000,
weights=aus_nomiss$SENWT)
stat
sort(stat$t)[25]
sort(stat$t)[975]
coef[4,1]-qt(0.975, n-5)*coef[4,2]
coef[4,1]+qt(0.975, n-5)*coef[4,2]
calc_pred <- function(d, i, newd) {
x <- d[i,]
mod <- glm(science_std~gender+JOYSCIE+nbooks+ntvs, data=x,
weights=SENWT)
pred <- predict(mod, newd)
return(pred)
}
summary(SENWT)
summary(aus_nomissSENWT)
summary(aus_nomiss$SENWT)
new_data <- data.frame(gender=1, JOYSCIE=1.0, nbooks=3, ntvs=3, SENWT=0.2)
new_data$gender <- factor(new_data$gender, levels=c(1,2), labels=c("f","m"))
pred <- boot(aus_nomiss, statistic=calc_pred, R=1000,
weights=aus_nomiss$SENWT, newd=new_data)
pred
sort(pred$t)[25]
sort(pred$t)[975]
sort(pred$t)[25]*sd(aus_nomiss$science)+mean(aus_nomiss$science)
sort(pred$t)[975]*sd(aus_nomiss$science)+mean(aus_nomiss$science)
new_data <- data.frame(gender=2, JOYSCIE=1.0, nbooks=3, ntvs=3, SENWT=0.2)
new_data$gender <- factor(new_data$gender, levels=c(1,2), labels=c("f","m"))
pred <- boot(aus_nomiss, statistic=calc_pred, R=1000,
weights=aus_nomiss$SENWT, newd=new_data)
pred
sort(pred$t)[25]
sort(pred$t)[975]
sort(pred$t)[25]*sd(aus_nomiss$science)+mean(aus_nomiss$science)
sort(pred$t)[975]*sd(aus_nomiss$science)+mean(aus_nomiss$science)
calc_res <- function(d, i) {
x <- d[i,]
mod <- glm(science_std~gender+JOYSCIE+nbooks+ntvs, data=x,
weights=SENWT)
res <- residuals(mod)
return(c(l=min(res), u=max(res)))
}
res <- boot(aus_nomiss, statistic=calc_res, R=1000,
weights=aus_nomiss$SENWGT_STU)
res <- boot(aus_nomiss, statistic=calc_res, R=1000,
weights=aus_nomiss$SENWT)
l <- sort(res$t[,1])[25]
u <- sort(res$t[,2])[975]
l
u
new_data <- data.frame(gender=1, JOYSCIE=1.0, nbooks=3, ntvs=3, SENWT=0.2)
new_data$gender <- factor(new_data$gender, levels=c(1,2), labels=c("f","m"))
pred <- boot(aus_nomiss, statistic=calc_pred, R=1000,
weights=aus_nomiss$SENWT, newd=new_data)
pred <- predict(aus_glm, new_data)
(pred+l)*sd(aus_nomiss$science)+mean(aus_nomiss$science)
(pred+u)*sd(aus_nomiss$science)+mean(aus_nomiss$science)
