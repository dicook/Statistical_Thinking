oly_glm <- glm(M2012~GDP_log, data=oly_gdp2012,
family=poisson(link=log))
summary(oly_glm)$coefficients
oly_augment <- augment(oly_glm) %>%
mutate(.fitted_exp = exp(.fitted)) %>%
arrange(GDP_log)
oly_augment %>% arrange(.cooksd) %>%
select(.cooksd)
oly_augment %>% arrange(.cooksd) %>%
select(.cooksd, .resid)
oly_augment <- augment(oly_glm)
rownames(oly_augment) <- oly_gdp2012$Country
oly_augment <-  oly_augment %>%
mutate(.fitted_exp = exp(.fitted)) %>%
arrange(GDP_log)
oly_augment %>% arrange(.cooksd) %>%
select(.cooksd, .resid)
oly_augment %>% arrange(.cooksd) %>%
select(.rownames, .cooksd, .resid)
?augment
oly_augment <- augment(oly_glm, data=TRUE)
oly_glm
residuals(oly_glm)
aus <- oly_gdp2012 %>% filter(Code == "AUS")
predict(oly_glm, aus)
?predict.glm
predict(oly_glm, aus, type="response")
oly_augment %>% arrange(desc(.cooksd)) %>%
select(.rownames, .cooksd, .resid)
ggplot(tennis_augment, aes(x=.resid)) +
geom_histogram()
library(knitr)
opts_chunk$set(
message = FALSE,
warning = FALSE,
cache = FALSE,
echo=FALSE,
fig.height = 2,
fig.width = 5,
collapse = TRUE,
comment = "#>"
)
options(digits=2)
library(dplyr)
library(tidyr)
library(ggplot2)
library(readr)
library(gridExtra)
library(broom)
oly_gdp2012 <- read.csv("../data/olympics_gdp_all.csv")
oly_gdp2012 <- oly_gdp2012 %>%
mutate(GDP_log=log10(GDP))
rownames(oly_gdp2012) <- oly_gdp2012$Country
ggplot(oly_gdp2012, aes(x=GDP_log, y=M2012)) + geom_point()
oly_glm <- glm(M2012~GDP_log, data=oly_gdp2012,
family=poisson(link=log))
summary(oly_glm)$coefficients
oly_augment <- augment(oly_glm)
rownames(oly_augment) <- oly_gdp2012$Country
oly_augment <-  oly_augment %>%
mutate(.fitted_exp = exp(.fitted)) %>%
arrange(GDP_log)
p1 <- ggplot(oly_gdp2012, aes(x=GDP_log, y=M2012)) +
geom_point() +
geom_line(data=oly_augment, aes(x=GDP_log, y=.fitted_exp),
colour="red")
p2 <- ggplot(oly_gdp2012, aes(x=GDP_log, y=log(M2012))) +
geom_point() +
geom_line(data=oly_augment, aes(x=GDP_log, y=.fitted),
colour="red")
grid.arrange(p1, p2, ncol=2)
summary(oly_glm)
p1 <- ggplot(oly_augment, aes(x=GDP_log, y=.resid)) +
geom_point() + ylab("Residuals") +
theme(aspect.ratio=1)
p2 <- ggplot(oly_augment, aes(x=.resid)) +
geom_histogram(binwidth=1) + xlab("Residuals")
grid.arrange(p1, p2, ncol=2)
oly_augment %>% arrange(desc(.cooksd)) %>%
select(.rownames, .cooksd, .resid)
aus <- oly_gdp2012 %>% filter(Code == "AUS")
predict(oly_glm, aus)
aus <- oly_gdp2012 %>% filter(Code == "AUS")
predict(oly_glm, aus, type="response")
tennis <- read_csv("../data/tennis_2012_wta.csv")
p1 <- ggplot(tennis, aes(x=Receiving.Points.Won, y=won)) + geom_point()
p2 <- ggplot(tennis, aes(x=Receiving.Points.Won, y=won)) + geom_jitter()
grid.arrange(p1, p2, ncol=2)
tennis_glm <- glm(won~Receiving.Points.Won, data=tennis,
family=binomial(link='logit'))
summary(tennis_glm)$coefficients
tennis_augment <- augment(tennis_glm) %>%
mutate(.fitted_ln=exp(.fitted)/(1+exp(.fitted))) %>%
arrange(Receiving.Points.Won)
ggplot(tennis, aes(x=Receiving.Points.Won, y=won)) + geom_point() +
geom_line(data=tennis_augment, aes(x=Receiving.Points.Won,
y=.fitted_ln), colour="red")
summary(tennis_glm)
ggplot(tennis_augment, aes(x=.resid)) +
geom_histogram()
tennis_augment %>% arrange(desc(.cooksd)) %>%
select(.cooksd, .resid)
newdata <- data.frame(Receiving.Points.Won=c(20, 50), won=c(NA, NA))
predict(tennis_glm, newdata)
predict(tennis_glm, newdata, type="response")
citation()
citation("plotly")
install.packages("nortest")
library(knitr)
opts_chunk$set(
message = FALSE,
warning = FALSE,
cache = FALSE,
echo=FALSE,
fig.height = 4,
fig.width = 4,
fig.align='center'
)
options(digits=3)
library(dplyr)
library(tidyr)
library(ggplot2)
library(readr)
library(gridExtra)
library(broom)
radon_lm_fit <- radon_sub; radon_lm_fit$fit <- fitted(radon_lm)
library(knitr)
opts_chunk$set(
message = FALSE,
warning = FALSE,
cache = FALSE,
echo=FALSE,
fig.height = 4,
fig.width = 4,
fig.align='center'
)
options(digits=3)
library(dplyr)
library(tidyr)
library(ggplot2)
library(readr)
library(gridExtra)
library(broom)
library(HLMdiag)
data(radon)
radon <- radon %>% rename(storey=basement)
glimpse(radon)
ggplot(radon, aes(x=uranium, y=log.radon)) + geom_point()
radon_keep <- radon %>% group_by(county) %>%
tally() %>% filter(n > 4)
radon_sub <- radon %>%
filter(county %in% radon_keep$county & log.radon > -2)
radon_sub$storey <-
factor(radon_sub$storey, levels=c(0,1),
labels=c("basement", "first floor"))
ggplot(radon_sub, aes(x=uranium, y=log.radon)) +
geom_point() +
geom_smooth(method="lm", se=F) +
facet_wrap(~storey)
radon_lm <- glm(log.radon ~ storey + uranium,
data = radon_sub)
summary(radon_lm)
radon_lm_fit <- radon_sub; radon_lm_fit$fit <- fitted(radon_lm)
ggplot(radon_lm_fit, aes(x=uranium, y=log.radon, colour=storey)) + geom_point() +
geom_line(aes(y=fit))
ggplot(radon_lm_fit, aes(x=uranium, y=log.radon, colour=storey)) + geom_point() +
geom_line(aes(y=fit)) + scale_colour_brewer(palette="Dark2")
library(knitr)
opts_chunk$set(
message = FALSE,
warning = FALSE,
cache = FALSE,
echo=FALSE,
fig.height = 6,
fig.width = 9,
fig.align='center'
)
options(digits=3)
library(dplyr)
library(tidyr)
library(ggplot2)
library(readr)
library(gridExtra)
library(broom)
coef <- coefficients(radon_lm)
coef
radon_lm <- glm(log.radon ~ storey*uranium, data = radon_sub)
coef
coef <- coefficients(radon_lm)
coef
library(knitr)
opts_chunk$set(
message = FALSE,
warning = FALSE,
cache = FALSE,
echo=FALSE,
fig.height = 6,
fig.width = 9,
fig.align='center'
)
options(digits=3)
library(dplyr)
library(tidyr)
library(ggplot2)
library(readr)
library(gridExtra)
library(broom)
library(HLMdiag)
data(radon)
radon <- radon %>% rename(storey=basement)
glimpse(radon)
ggplot(radon, aes(x=uranium, y=log.radon)) + geom_point()
radon_keep <- radon %>% group_by(county) %>%
tally() %>% filter(n > 4)
radon_sub <- radon %>%
filter(county %in% radon_keep$county & log.radon > -2)
radon_sub$storey <-
factor(radon_sub$storey, levels=c(0,1),
labels=c("basement", "first floor"))
ggplot(radon_sub, aes(x=uranium, y=log.radon)) +
geom_point() +
geom_smooth(method="lm", se=F) +
facet_wrap(~storey)
radon_lm <- glm(log.radon ~ storey + uranium,
data = radon_sub)
summary(radon_lm)
radon_lm_fit <- radon_sub; radon_lm_fit$fit <- fitted(radon_lm)
ggplot(radon_lm_fit, aes(x=uranium, y=log.radon, colour=storey)) + geom_point() +
geom_line(aes(y=fit)) + scale_colour_brewer(palette="Dark2")
library(knitr)
opts_chunk$set(
message = FALSE,
warning = FALSE,
cache = FALSE,
echo=FALSE,
fig.height = 6,
fig.width = 9,
fig.align='center'
)
options(digits=3)
library(dplyr)
library(tidyr)
library(ggplot2)
library(readr)
library(gridExtra)
library(broom)
library(rpart)
library(tidyverse)
help(package="rpart")
x=sort(runif(100)-0.5)
df <- data.frame(x, y=c(x[1:50]^2, x[51:75]*2, -x[76:100]^2))
ggplot(df, aes(x=x, y=y)) + geom_point()
df <- data.frame(x, y=c(x[1:50]^2, x[51:75]*2, -x[76:100]^2)+rnorm(100)*0.1)
ggplot(df, aes(x=x, y=y)) + geom_point()
df.rp <- rpart(y~x, data=df)
df.rp
plot(df_rp)
df_rp <- rpart(y~x, data=df)
df_rp
plot(df_rp)
library(rpart.plot)
install.packages("rpart.plot")
library(rpart.plot)
help(package="rpart.plot")
rpart.plot(df_rp)
data(ptitanic)
tree <- rpart(survived ~ ., data=ptitanic, cp=.02)
# cp=.02 because want small tree for demo
old.par <- par(mfrow=c(2,2))
# put 4 figures on one page
prp(tree, main="default prp\n(type = 0, extra = 0)")
ggplot(df, aes(x=x, y=y)) + geom_point() +
geom_vline(xintercept = 0.299)
ggplot(df, aes(x=x, y=y)) + geom_point() +
geom_vline(xintercept = 0.299)
ggplot(df, aes(x=x, y=y)) + geom_point() +
geom_vline(xintercept = 0.299) +
geom_vline(xintercept = 0.447)
ggplot(df, aes(x=x, y=y)) + geom_point() +
geom_vline(xintercept = 0.299) +
geom_vline(xintercept = 0.447) +
geom_vline(xintercept = 0.146)
ggplot(df, aes(x=x, y=y)) + geom_point() +
geom_vline(xintercept = 0.299, colour="hotpink") +
geom_vline(xintercept = 0.447, colour="hotpink") +
geom_vline(xintercept = 0.146, colour="hotpink") +
geom_vline(xintercept = -0.354, colour="hotpink")
ggplot(df, aes(x=x, y=y)) + geom_point() +
geom_vline(xintercept = 0.299, colour="hotpink") +
geom_vline(xintercept = 0.447, colour="hotpink") +
geom_vline(xintercept = 0.146, colour="hotpink") +
geom_vline(xintercept = -0.354, colour="hotpink") +
geom_vline(xintercept = 0.044, colour="hotpink")
ggplot(df, aes(x=x, y=y)) + geom_point() +
geom_vline(xintercept = 0.299, colour="hotpink") +
geom_vline(xintercept = 0.447, colour="hotpink") +
geom_vline(xintercept = 0.146, colour="hotpink") +
geom_vline(xintercept = -0.354, colour="hotpink") +
geom_vline(xintercept = 0.044, colour="hotpink") +
geom_vline(xintercept = -0.206, colour="hotpink")
?cut
df_fit <- df %>%
mutate(partitions = cut(x,
breaks=c(-0.354, -0.206, 0.044,
0.146, 0.299, 0.447))) %>%
group_by(partitions) %>%
mutate(x=mean(x), y=mean(y))
ggplot(df, aes(x=x, y=y)) + geom_point() +
geom_vline(xintercept = 0.299, colour="hotpink") +
geom_vline(xintercept = 0.447, colour="hotpink") +
geom_vline(xintercept = 0.146, colour="hotpink") +
geom_vline(xintercept = -0.354, colour="hotpink") +
geom_vline(xintercept = 0.044, colour="hotpink") +
geom_vline(xintercept = -0.206, colour="hotpink") +
geom_point(data=df_fit, aes(x=x, y=y),
colour="hotpink", size=3, alpha=0.5)
df_fit
df_fit <- df %>%
mutate(partitions = cut(x,
breaks=c(-Inf, -0.354, -0.206, 0.044,
0.146, 0.299, 0.447, -Inf))) %>%
group_by(partitions) %>%
mutate(x=mean(x), y=mean(y))
df_fit <- df %>%
mutate(partitions = cut(x,
breaks=c(-Inf, -0.354, -0.206, 0.044,
0.146, 0.299, 0.447, Inf))) %>%
group_by(partitions) %>%
mutate(x=mean(x), y=mean(y))
df_fit
df_fit <- df %>%
mutate(partitions = cut(x,
breaks=c(-Inf, -0.354, -0.206, 0.044,
0.146, 0.299, 0.447, Inf))) %>%
group_by(partitions) %>%
summarise(x=mean(x), y=mean(y))
df_fit
ggplot(df, aes(x=x, y=y)) + geom_point() +
geom_vline(xintercept = 0.299, colour="hotpink") +
geom_vline(xintercept = 0.447, colour="hotpink") +
geom_vline(xintercept = 0.146, colour="hotpink") +
geom_vline(xintercept = -0.354, colour="hotpink") +
geom_vline(xintercept = 0.044, colour="hotpink") +
geom_vline(xintercept = -0.206, colour="hotpink") +
geom_point(data=df_fit, aes(x=x, y=y),
colour="hotpink", size=3, alpha=0.5)
ggplot(df, aes(x=x, y=y)) + geom_point() +
geom_vline(xintercept = 0.299, colour="hotpink") +
geom_vline(xintercept = 0.447, colour="hotpink") +
geom_vline(xintercept = 0.146, colour="hotpink") +
geom_vline(xintercept = -0.354, colour="hotpink") +
geom_vline(xintercept = 0.044, colour="hotpink") +
geom_vline(xintercept = -0.206, colour="hotpink") +
geom_point(data=df_fit, aes(x=x, y=y),
colour="hotpink", size=5, alpha=0.7)
set.seed(772017)
x=sort(runif(100)-0.5)
df <- data.frame(x, y=c(x[1:50]^2, x[51:75]*2, -x[76:100]^2)+rnorm(100)*0.1)
ggplot(df, aes(x=x, y=y)) + geom_point()
library(rpart)
df_rp <- rpart(y~x, data=df)
df_rp
set.seed(777)
x=sort(runif(100)-0.5)
df <- data.frame(x, y=c(x[1:50]^2, x[51:75]*2, -x[76:100]^2)+rnorm(100)*0.1)
ggplot(df, aes(x=x, y=y)) + geom_point()
unlink('week7.class2_cache', recursive = TRUE)
library(rpart)
df_rp <- rpart(y~x, data=df)
df_rp
str(rp)
str(df_rp)
df_rp$splits
df_rp$splits$index
df_rp$splits[,4]
unlink('week7.class2_cache', recursive = TRUE)
str(df_rp)
str(df_rp$control)
df_rp <- rpart(y~x, data=df, control = rpart.control(minsplit=10, minbucket = 3))
df_rp
df_rp <- rpart(y~x, data=df, control = rpart.control(minsplit=5, minbucket = 2))
df_rp
df_rp <- rpart(y~x, data=df,
control = rpart.control(minsplit=30, minbucket = 10))
df_rp
sst <- var(df$y)*nrow(df)
sst
compute_anova <- function(left, right) {
ssl <- var(left$y)*nrow(df)
ssr <- var(right$y)*nrow(df)
av <- sst - (ssl+ssr)
return(av)
}
i=2
left <- df[1:(i-1),]
right <- df[i:nrow(df),]
aov_f$x <- mean(df$x[c(i-1, i)])
aov_f <- data.frame(x=df$x[-1], f=x=df$y[-1])
aov_f <- data.frame(x=df$x[-1], f=df$y[-1])
aov_f$x <- mean(df$x[c(i-1, i)])
aov_f$f <- compute_anova(left, right)
aov_f[1,]
ssl <- var(left$y)*nrow(df)
ssr <- var(right$y)*nrow(df)
ssl
compute_anova <- function(left, right) {
ssl <- var(left$y)*nrow(left)
if (nrow(left) == 1)
ssl <- 1
ssr <- var(right$y)*nrow(right)
if (nrow(right) == 1)
ssr <- 1
av <- sst - (ssl+ssr)
return(av)
}
aov_f$f <- compute_anova(left, right)
aof_f[1,]
aov_f[1,]
aov_f <- data.frame(x=df$x[-1], f=df$y[-1])
for (i in 2:nrow(df)) {
left <- df[1:(i-1),]
right <- df[i:nrow(df),]
aov_f$x <- mean(df$x[c(i-1, i)])
aov_f$f <- compute_anova(left, right)
}
aof_f
aov_f
aov_f <- data.frame(x=df$x[-1], f=df$y[-1])
for (i in 2:nrow(df)) {
left <- df[1:(i-1),]
right <- df[i:nrow(df),]
aov_f$x[i] <- mean(df$x[c(i-1, i)])
aov_f$f[i] <- compute_anova(left, right)
}
aov_f <- data.frame(x=df$x[-1], f=df$y[-1])
for (i in 2:nrow(df)) {
left <- df[1:(i-1),]
right <- df[i:nrow(df),]
aov_f$x[i-1] <- mean(df$x[c(i-1, i)])
aov_f$f[i-1] <- compute_anova(left, right)
}
aov_f
ggplot(df, aes(x=x, y=y)) + geom_point(alpha=0.5) +
geom_line(data=aov_f, aes(x=x, y=f), colour="hotpink")
+
ggplot(df, aes(x=x, y=y)) + geom_point(alpha=0.5) +
geom_line(data=aov_f, aes(x=x, y=f), colour="hotpink") +
geom_vline(xintercept = df_rp$splits[1,4], colour="hotpink", linetype=2)
ggplot(df, aes(x=x, y=y)) + geom_point(alpha=0.5) +
geom_line(data=aov_f, aes(x=x, y=f), colour="hotpink") +
geom_vline(xintercept = df_rp$splits[1,4], colour="hotpink", linetype=2)
unlink('week7.class2_cache', recursive = TRUE)
?augment
df_rp_aug <- augment(df_rp, df)
df_rp_aug <- col_bind(df, residuals(df_rp))
df_rp_aug <- column_bind(df, residuals(df_rp))
?row_bind
df_rp_aug <- bind_cols(df, residuals(df_rp))
df_rp_aug <- cbind(df, residuals(df_rp))
df_rp_aug
df_rp_aug <- cbind(df, e=residuals(df_rp))
df_rp_aug %>% head
ggplot(df_rp_aug, aes(x=x, y=e)) + geom_point() +
ylab("residuals")
str(df_rp)
df_rp <- rpart(y~x, data=df)
str(df_rp)
deviance(df_rp)
printcp(df_rp)
?printcp
printcp(df_rp, digits=5)
sum(df_rp_aug$e^2)/sst
1-sum(df_rp_aug$e^2)/sst
sst <- var(df$y)*(nrow(df)-1)
1-sum(df_rp_aug$e^2)/sst
1-sum(df_rp_aug$e^2)/sum((df$y-mean(df$y))^2)
printcp(df_rp, digits=3)
0.2160+0.0516+0.3010+0.0205+0.1190+0.0512+0.2470
sum((df$y-mean(df$y))^2)
sqrt(sum((df$y-mean(df$y))^2))
summary(df_rp)
unlink('week7.class2_cache', recursive = TRUE)
1-sum(df_rp_aug$e^2)/sum((df$y-mean(df$y))^2)
unlink('week7.class2_cache', recursive = TRUE)
gof <- printcp(df_rp, digits=3)
str(gof)
gof[7,3]
library(knitr)
opts_chunk$set(
message = FALSE,
warning = FALSE,
cache = FALSE,
echo=FALSE,
fig.height = 6,
fig.width = 9,
fig.align='center'
)
options(digits=3)
library(tidyverse)
library(gridExtra)
library(broom)
set.seed(8000)
x=sort(runif(100)-0.5)
df <- data.frame(x, y=c(x[1:50]^2, x[51:75]*2, -x[76:100]^2)+rnorm(100)*0.1)
ggplot(df, aes(x=x, y=y)) + geom_point()
library(rpart)
df_rp <- rpart(y~x, data=df)
df_rp
library(rpart.plot)
rpart.plot(df_rp)
df_rp$splits
unlink('week7.class2_cache', recursive = TRUE)
